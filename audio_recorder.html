<script>
    let mediaRecorder;
    let audioChunks = [];

    async function startRecording() {
        console.log("startRecording called");
        audioChunks = [];
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };
            mediaRecorder.start();
        } catch (err) {
            console.error("Error in startRecording:", err);
        }
    }

    async function stopRecording() {
        console.log("stopRecording called");
        try {
            mediaRecorder.stop();
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const reader = new FileReader();
            reader.readAsDataURL(audioBlob); 
            reader.onloadend = () => {
                let base64String = reader.result;
                base64String = base64String.split(',')[1];
                streamlitPython.sendBack({ type: "audio_data", value: base64String });
            };
        } catch (err) {
            console.error("Error in stopRecording:", err);
        }
    }

    document.addEventListener('DOMContentLoaded', (event) => {
        console.log("DOM fully loaded and parsed");
        document.getElementById('startRecord').addEventListener('click', startRecording);
        document.getElementById('stopRecord').addEventListener('click', stopRecording);
    });

</script>
